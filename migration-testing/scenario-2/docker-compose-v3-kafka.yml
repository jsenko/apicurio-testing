services:
  registry-v3:
    image: apicurio/apicurio-registry:3.1.2
    container_name: scenario2-registry-v3
    hostname: registry-v3
    ports:
      - "3333:8080"
    environment:
      # Storage configuration
      APICURIO_STORAGE_KIND: kafkasql

      # Kafka connection (KafkaSQL storage)
      # Use port 29092 (PLAINTEXT listener) for container-to-container communication
      APICURIO_KAFKASQL_BOOTSTRAP_SERVERS: scenario2-kafka:29092

      # Kafka topic for registry storage
      # CRITICAL: Use v3-specific topic - v3 CANNOT read v2's journal!
      APICURIO_KAFKASQL_TOPIC: kafkasql-journal-v3

      # HTTP configuration
      QUARKUS_HTTP_PORT: 8080

      # Logging
      QUARKUS_LOG_LEVEL: INFO
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health/live"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 20s
    networks:
      - scenario2-kafka
      - scenario2-v3
    restart: unless-stopped

networks:
  scenario2-kafka:
    name: scenario2-kafka-network
    external: true
  scenario2-v3:
    name: scenario2-v3-network
    external: true
